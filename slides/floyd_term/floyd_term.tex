\documentclass[hyperref={unicode=true}]{beamer}
\usepackage[utf8]{inputenx}
\usepackage[russian]{babel}

\usepackage{multicol}

\usepackage[pgf]{dot2texi}
\usepackage{tikz}
\usetikzlibrary{shapes, arrows}

\usepackage{listings}
\usepackage{graphicx}

\usepackage{comment}

\title{Лекция 3. Метод фундированных множеств Флойда}
\author{}
\date{}

\usetheme{Warsaw}

\AtBeginSection[] {
	\begin{frame}{Содержание}
		\tableofcontents[currentsection]
	\end{frame}
}
%\overfullrule=5pt

\begin{document}
	\begin{frame}{}
		\titlepage
	\end{frame}

    \begin{frame}{Цель лекции}
    Определить метод доказательства завершимости.
    \end{frame}

    \section{Доказательство на примере}

	\begin{frame}[fragile]{Пример для доказательства}
	\begin{multicols}{2}

	\huge
	\begin{dot2tex}[options=-traw]
	digraph G{
		d2tgraphstyle="scale=0.3, transform shape";

		/* nodes by levels */
		node[shape=rectangle, height=1];
		START[style=rounded, width=2, texlbl="$\begin{matrix}START:\\ y \leftarrow 0\end{matrix}$"];
		JOIN;
        COND[style=rounded, width=2.5, texlbl="$y = x \lor y = x + 1$"];
		INCR[width=2, texlbl="$y \leftarrow y + 2$"];
        HALT[style=rounded, width=2, texlbl="$\begin{matrix}HALT:\\  z \leftarrow y\end{matrix}$"];

		/* edges */
		node [shape=point, width=0, label=""];
		START -> JOIN [arrowhead=none]; JOIN -> COND [weight=8];
		{ rank=same; p1 -> JOIN; }
		p1 -> p5 [weight=8, arrowhead=none];
		{ rank=same; p3 -> COND [label="F", arrowhead=none]; COND -> p4 [label="T", arrowhead=none]; }
		p3 -> INCR [weight=8];
		p4 -> HALT [weight=8];
		{ rank=same; INCR; HALT; }
		INCR -> p6 [weight=8, arrowhead=none];
		{ rank=same; p5 -> p6 [arrowhead=none]; }
        }
	\end{dot2tex}

	\normalsize

    $\begin{matrix}
    D_x = \mathbb{Z}\\
    D_y = \mathbb{Z}\\
    D_z = \mathbb{Z}\\
    \varphi(x) \geq 0\\
    \end{matrix}$

	\end{multicols}

    Доказать, что блок-схема завершается при всех значениях входных переменных из указанного предусловия. Метод доказательства должен быть <<автоматизируемым>>.
	\end{frame}


    \begin{frame}{Поиск доказательства}
    Осознаем, что надо доказать: что при все вычисления при значениях входных переменных таких, что $\varphi(x)$:
    \begin{itemize}
    \item завершаются
    \item достигают связки перед оператором HALT
    \item что условие в операторе TEST не всегда ложно в вычислении
    \item что в каждом таком вычислении обязательно найдется конфигурация перед оператором TEST, в которой его предикат истинен. Если же такой конфигурации нет, то вычисление будет бесконечным.
    \end{itemize}

    Достижение чего-либо -- это словно приближение. Если есть некоторое определение расстояния до чего-то, которое на каждом шаге уменьшается, то рано или поздно мы остановимся.
    \end{frame}

    \begin{frame}{Поиск доказательства}
    Есть ли такое <<расстояние>> в нашем случае? Надо откуда-то догадаться, как можно определить расстояние. Например, так: $|x + 1 - y|$. Оно неотрицательно. Каждая конфигурация на связке перед оператором TEST с ложным предикатом на ней вынуждает выполнить итерацию цикла. Будет ли при этом уменьшаться расстояние -- проверим при помощи формул.

    $\forall x, y \in \mathbb{Z} ~ x \geq 0 \land y \neq x \land y \neq x + 1 \Rightarrow |x + 1 - (y + 2)| < |x + 1 - y|$.

    Это условие ложно. Строим контрпример: оно ложно при $y = 3, x = 1$. Но этот контрпример невозможен, т.к. он не соответствует оператору START. Как его учесть? Дополнительно доказать, что на каждой конфигурации перед TEST выполнено индуктивное утверждение $y \leq x + 1$.
    \end{frame}

    \begin{frame}{Индуктивное утверждение}
    Базовый путь из псевдосвязки перед START в точку сечения: $\forall x \in \mathbb{Z} ~ x \geq 0 \Rightarrow 0 \leq x + 1$

    Базовый путь из точки сечения в точку сечения: $\forall x, y \in \mathbb{Z} ~ x \geq 0 \land y \neq x \land y \neq x + 1 \land y \leq x + 1 \Rightarrow y + 2 \leq x + 1$

    Наконец, доказываем уменьшение расстояния:
    $\forall x, y \in \mathbb{Z} ~ x \geq 0 \land y \neq x \land y \neq x + 1 \land y \leq x + 1 \Rightarrow |x + 1 - (y + 2)| < |x + 1 - y|$.
    \end{frame}

    \begin{frame}{Доказательство}
    Итак, мы рассматривали конфигурации на связке перед оператором TEST (т.к. это точка сечения). Мы ввели <<расстояние>> от произвольной конфигурации этого множества до конфигурации, в которой истинен предикат в операторе TEST. Мы показали, что на всех путях между точками сечения (а такой путь один) расстояние уменьшается. То есть мы показали, что всякая конфигурация с ложными предикатом в TEST приводит к базовому пути, на котором расстояние уменьшается. Но т.к. расстояние неотрицательно, то оно не может уменьшаться бесконечно, значит в вычислении не могут бесконечно встречаться конфигурации, в которых предикат в операторе TEST ложен. Завершимость доказана.
    \end{frame}

    \section{Метод фундированных множеств}

    \begin{frame}{Предварительные определения}
	\emph{Отношение строгого частичного порядка} -- это бинарное отношение $\prec$ на некотором множестве $W$, обладающее следующими свойствами:
    \begin{enumerate}
    \item антирефлексивность: $\forall x \in W \cdot \neg (x \prec x)$.
    \item транзитивность: $\forall x, y, z \in W \cdot x \prec y \land y \prec z \Rightarrow x \prec z$.
    \end{enumerate}

    \emph{Фундированное множество} -- множество, снабженное отношением строгого частичного порядка, в котором не существует бесконечно убывающей последовательности элементов.
    \end{frame}

	\begin{frame}{Метод фундированных множеств}

    \begin{block}{Шаг 1}
	Выбор множества т.с. (все циклические пути имеют т.с.) и фундированного множества $(W,~\prec)$.
	\end{block}
	\begin{block}{Шаг 2}
	Выбор индуктивного утверждения для каждой т.с., выписывание условий верификации для каждого
	базового пути между точками сечения и псевдосвязкой у START.
	\end{block}
	\begin{block}{Шаг 3}
	Выбор оценочной функции для каждой точки сечения ($u_A~:~D_{\bar{x}}~\times~D_{\bar{y}}~\rightarrow~W'$, $W \subseteq W'$).
	\end{block}
	\end{frame}

	\begin{frame}{Метод фундированных множеств (продолжение)}

	\begin{block}{Шаг 4}
	Выписывание условия корректности оценочной функции для каждой точки сечения:
	$\forall \bar{x} \in D_{\bar{x}} ~\forall \bar{y} \in D_{\bar{y}} ~\cdot~
	\varphi(\bar{x}) \land p_A(\bar{x},~\bar{y}) \Rightarrow u_A(\bar{x},~\bar{y}) \in W$.
	\end{block}
	\begin{block}{Шаг 5}
	Выписывание условия завершимости для каждого базового пути между точками сечения (из А в В):
	$\forall \bar{x} \in D_{\bar{x}} ~ \forall \bar{y} \in D_{\bar{y}} ~\cdot~
	\varphi(\bar{x}) \land p_A(\bar{x},~\bar{y})~\land~R_\alpha(\bar{x},~\bar{y}) \Rightarrow
	u_B(\bar{x},~r_\alpha(\bar{x},~\bar{y})) ~\prec~ u_A(\bar{x},~\bar{y})$.
	\end{block}
	\end{frame}

	\begin{frame}{Корректность метода фундированных множеств}

	\begin{block}{Теорема}
	Дана блок-схема $P$, спецификация $(\varphi,~\psi)$. Если все составленные условия верификации, корректности и завершимости истинны, то $\langle\varphi\rangle~P~\langle T \rangle$, т.е. блок-схема завершима.
	\end{block}

    Схема доказательства: по индукции доказать выполнение индуктивных утверждений в точках сечения, из фундированности $W$ сделать вывод об отсутствии бесконечных вычислений.
	\end{frame}

	\begin{frame}{Примеры фундированных множеств}
	\begin{block}{Натуральные числа}
	$W~\equiv~\{0,~1,~2,~\ldots\}$ -- множество целых неотрицательных чисел

	$x~\prec~y~\equiv~x~<~y$ -- с естественным порядком на нем
	\end{block}
	\begin{block}{Кортежи}
	$W~\equiv~W_1~\times~W_2$ -- пара двух фундированных множеств $(W_1,~\prec_1)$ и $(W_2,~\prec_2)$.

	$(x_1,~x_2)~\prec~(y_1,~y_2) ~\equiv~ x_1~\prec_1~y_1~\lor~x_1~=~y_1 \land x_2~\prec_2~y_2$ -- лексикографический порядок.
	\end{block}
	\end{frame}

\end{document}

